<div class="container mx-auto px-4 py-8 max-w-3xl">
  <div class="mb-8 flex justify-between items-center">
    <div class="step" [class.active]="currentStep() >= 1">
      <div class="step-circle">1</div>
      <p class="step-label">Pet</p>
    </div>
    <div class="flex-1 h-px bg-gray-200"></div>
    <div class="step" [class.active]="currentStep() >= 2">
      <div class="step-circle">2</div>
      <p class="step-label">Serviço</p>
    </div>
    <div class="flex-1 h-px bg-gray-200"></div>
    <div class="step" [class.active]="currentStep() >= 3">
      <div class="step-circle">3</div>
      <p class="step-label">Horário</p>
    </div>
    <div class="flex-1 h-px bg-gray-200"></div>
    <div class="step" [class.active]="currentStep() >= 4">
      <div class="step-circle">4</div>
      <p class="step-label">Confirmar</p>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-md p-6 relative">
    <button
      (click)="cancel()"
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition"
    >
      <fa-icon [icon]="faArrowLeft" class="mr-2"></fa-icon>
      Cancelar
    </button>
    @switch (currentStep()) { @case (1) {
    <div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 mt-6">Para qual pet é o serviço?</h2>
      <div class="space-y-3">
        @for (pet of pets(); track pet.id) {
        <div
          (click)="selectPet(pet)"
          class="flex items-center p-4 border rounded-lg hover:bg-blue-50 cursor-pointer transition"
        >
          <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mr-4">
            <fa-icon [icon]="faPaw" class="text-indigo-500 text-2xl"></fa-icon>
          </div>
          <div>
            <p class="font-bold text-lg text-gray-800">{{ pet.name }}</p>
            <p class="text-gray-600">{{ pet.breed.name }}</p>
          </div>
        </div>
        }
      </div>
    </div>
    } @case (2) {
    <div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 mt-6">
        Qual serviço você deseja para {{ selectedPet()?.name }}?
      </h2>
      <div class="space-y-3">
        @for (service of services(); track service.id) {
        <div
          (click)="selectService(service)"
          class="p-4 border rounded-lg hover:bg-blue-50 hover:border-blue-500 cursor-pointer transition"
        >
          <div class="flex justify-between items-center">
            <div>
              <p class="font-bold text-lg text-gray-800">{{ service.name }}</p>
              <p class="text-sm text-gray-500 mt-1">
                Duração: {{ service.estimatedDurationInMinutes }} min
              </p>
            </div>
            <p class="font-bold text-lg text-gray-800">{{ service.price | currency : 'BRL' }}</p>
          </div>
        </div>
        } @empty {
        <p class="text-gray-500">Carregando serviços...</p>
        }
      </div>
      <div class="mt-6 flex justify-between items-center">
        <button
          (click)="goBack()"
          class="text-gray-600 hover:text-gray-900 font-medium py-3 px-6 rounded-lg transition"
        >
          Voltar
        </button>
      </div>
    </div>
    } @case (3) {
    <div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 mt-6">
        Escolha o profissional e o horário
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="employeeSelect" class="block text-sm font-medium text-gray-700 mb-1"
            >Profissional de Preferência</label
          >
          <select
            id="employeeSelect"
            (change)="onEmployeeChange($event)"
            class="w-full p-2 border border-gray-300 rounded-md shadow-sm"
          >
            <option [ngValue]="null">Qualquer Um</option>
            @for (employee of qualifiedEmployees(); track employee.id) {
            <option [value]="employee.id">{{ employee.name }}</option>
            }
          </select>
        </div>
        <div>
          <label for="appointmentDate" class="block text-sm font-medium text-gray-700 mb-1"
            >Data do Agendamento</label
          >
          <input
            type="date"
            id="appointmentDate"
            [min]="todayString"
            (change)="onDateChange($event)"
            class="w-full p-2 border border-gray-300 rounded-md shadow-sm"
          />
        </div>
      </div>
      @if (selectedDate()) {
      <div class="mt-6">
        <h3 class="text-lg font-medium text-gray-700 mb-3">
          Horários disponíveis para {{ selectedDate() | date : 'dd/MM/yyyy' }}
        </h3>
        @if (isLoadingTimes()) {
        <p class="text-center text-gray-500 py-4">Carregando horários...</p>
        } @else {
        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
          @for (time of availableTimes(); track time) {
          <button
            (click)="selectTime(time)"
            [disabled]="isTimeInPast(time)"
            class="p-2 border rounded-md text-center font-medium transition"
            [ngClass]="{
              'bg-blue-600 text-white border-blue-600': selectedTime() === time,
              'bg-white hover:border-blue-500': selectedTime() !== time,
              'disabled-time-slot': isTimeInPast(time)
            }"
          >
            {{ time | date : 'HH:mm' }}
          </button>
          } @empty {
          <p class="col-span-full text-center text-gray-500 py-4">
            Nenhum horário disponível para esta data/profissional.
          </p>
          }
        </div>
        }
      </div>
      }
      <div class="mt-6 flex justify-between items-center">
        <button
          (click)="goBack()"
          class="text-gray-600 hover:text-gray-900 font-medium py-3 px-6 rounded-lg transition"
        >
          Voltar
        </button>
        <button
          (click)="goToNextStep()"
          [disabled]="!selectedTime()"
          class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Próximo
        </button>
      </div>
    </div>
    } @case (4) {
    <div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 mt-6">Confirme os detalhes</h2>
      <div class="space-y-4 text-gray-700 border p-4 rounded-lg">
        <div class="flex justify-between">
          <span class="font-medium">Pet:</span>
          <span>{{ selectedPet()?.name }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3">
          <span class="font-medium">Serviço:</span>
          <span>{{ selectedService()?.name }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3">
          <span class="font-medium">Profissional:</span>
          <span>{{ selectedEmployeeName() }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3">
          <span class="font-medium">Data:</span>
          <span>{{ selectedDate() | date : 'fullDate' }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3">
          <span class="font-medium">Horário:</span>
          <span>{{ selectedTime() | date : 'HH:mm' }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3 text-lg font-bold text-gray-800">
          <span>Valor Total:</span>
          <span>{{ selectedService()?.price | currency : 'BRL' }}</span>
        </div>
      </div>

      <div class="mt-6 flex justify-between items-center">
        <button
          (click)="goBack()"
          class="text-gray-600 hover:text-gray-900 font-medium py-3 px-6 rounded-lg transition"
        >
          Voltar
        </button>
        <button
          (click)="confirmAppointment()"
          class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-8 rounded-lg transition duration-200"
        >
          Confirmar Agendamento
        </button>
      </div>
    </div>
    } @case (5) {
    <div class="text-center py-10">
      <div
        class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4"
      >
        <fa-icon [icon]="faCheckCircle" class="w-8 h-8 text-green-600"></fa-icon>
      </div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-2">Agendamento Realizado!</h2>
      <p class="text-gray-600 mb-6">Seu horário foi confirmado com sucesso. Te esperamos!</p>
      <div class="flex justify-center gap-4">
        <button
          (click)="scheduleAnother()"
          class="text-blue-600 hover:text-blue-800 font-medium py-3 px-6 rounded-lg transition"
        >
          Agendar outro serviço
        </button>
        <button
          (click)="goToDashboard()"
          class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition duration-200"
        >
          Ir para a Dashboard
        </button>
      </div>
    </div>
    } }
  </div>
</div>
